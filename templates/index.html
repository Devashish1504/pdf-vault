<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFVault</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="container">
        <header>
            <h1>PDFVault</h1>
            <p>Secure PDF Processing</p>
            <nav>
                <a href="/">Home</a>
                <a href="/upload">Upload</a>
                <a href="/encrypt">Encrypt</a>
                <a href="/decrypt">Decrypt</a>
                <a href="/metadata">Metadata</a>
                {% if current_user %}
                <a href="/my-files">My Files</a>
                {% endif %}
                <a href="/admin">Admin</a>
            </nav>
            <div class="auth-section">
                {% if current_user %}
                <span class="user-info">{{ current_user.name or current_user.email }}</span>
                <a href="/logout" class="auth-btn logout" id="logout-btn">Logout</a>
                {% else %}
                <a href="/login" class="auth-btn">Login</a>
                <span class="guest-badge">Guest Mode</span>
                {% endif %}
            </div>
        </header>

        {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}
        <div class="flash">{{ message }}</div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}
        <div class="card">
            <h2>Welcome{% if current_user %}, {{ current_user.name or 'User' }}{% endif %}</h2>
            <p>PDFVault is a secure PDF processing platform.</p>
            {% if not current_user %}
            <div class="guest-notice">
                <strong>Guest Mode:</strong> Your files are temporary. <a href="/login">Login</a> to save files
                permanently.
            </div>
            {% endif %}
        </div>

        <div class="card">
            <h2>Features</h2>
            <p><strong>Upload</strong> – Store PDF files<br>
                <strong>Encrypt</strong> – Password-protect PDFs<br>
                <strong>Decrypt</strong> – Test password recovery<br>
                <strong>Metadata</strong> – Extract document info
            </p>
        </div>
        {% endblock %}

        <footer>
            PDFVault – Secure Document Processing
        </footer>
    </div>

    {% if current_user and clerk_key %}
    <script async crossorigin="anonymous" data-clerk-publishable-key="{{ clerk_key }}"
        src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js" type="text/javascript"></script>
    <script>
        window.addEventListener('load', async () => {
            await Clerk.load();

            document.getElementById('logout-btn')?.addEventListener('click', async (e) => {
                e.preventDefault();
                await Clerk.signOut();
                window.location.href = '/logout';
            });
        });
    </script>
    {% endif %}
</body>

</html>